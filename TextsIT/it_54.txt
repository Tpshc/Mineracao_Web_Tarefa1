1
Random Pilot and Data Access in Massive MIMO
for Machine-type Communications
Elisabeth de Carvalho, Senior Member, IEEE, Emil Bjo?rnson, Member, IEEE, Jesper H. Sørensen, Member, IEEE,
Erik G. Larsson, Fellow, IEEE, Petar Popovski, Fellow, IEEE
Abstract—A massive MIMO system, represented by a base
station with hundreds of antennas, is capable of spatially mul-
tiplexing many devices and thus naturally suited to serve dense
crowds of wireless devices in emerging applications, such as
machine-type communications. Crowd scenarios pose new chal-
lenges in the pilot-based acquisition of channel state information
and call for pilot access protocols that match the intermittent
pattern of device activity. A joint pilot assignment and data
transmission protocol based on random access is proposed in
this paper for the uplink of a massive MIMO system. The
protocol relies on the averaging across multiple transmission slots
of the pilot collision events that result from the random access
process. We derive new uplink sum rate expressions that take
pilot collisions, intermittent device activity, and interference into
account. Simplified bounds are obtained and used to optimize
the device activation probability and pilot length. A performance
analysis indicates how performance scales as a function of the
number of antennas and the transmission slot duration.
I. INTRODUCTION
In a massive multiple-input multiple-output (MIMO) sys-
tem [1], the base station (BS) is equipped with a very large
number of antennas that create a very large number of spatial
degrees of freedom (DoFs) under the asymptotic favorable
propagation conditions that most channels seem to offer [2]–
[4]. Those spatial DoFs can be used in different ways. If the
number of antennas at the BS is much larger than the number
of wireless devices [1], then the extra DoFs are exploited
to generate strong spatial beams to the devices, which are
in effect hardened communication channels with negligible
small-scale fading and a minor multi-user interference. When
the number of devices is large, the DoFs can be used for
aggressive spatial multiplexing of devices, which does bring
the largest cell spectral efficiency [5]. However, the devices’
channels are not asymptotically decorrelated in this operating
regime and the spectral efficiency per device is thus lowered.
The enhanced spatial resolution of massive MIMO is essential
E. de Carvalho, J. H. Sørensen, and P. Popovski are with the De-
partment of Electronic Systems, Aalborg University, Aalborg, Denmark
(email: edc@es.aau.dk, jhs@es.aau.dk, petarp@es.aau.dk). E. Bjo?rnson and
E. G. Larsson are with the Department of Electrical Engineering (ISY),
Linko?ping University, Linko?ping, Sweden (email: emil.bjornson@liu.se,
erik.g.larsson@liu.se).
This work was performed partly in the framework of the Danish Council
for Independent Research (DFF133500273), the Danish National Advanced
Technology Foundation via the VIRTUOSO project, the Horizon 2020 project
FANTASTIC-5G (ICT-671660), the EU FP7 project MAMMOET (ICT-
619086), ELLIIT, and CENIIT. The authors would like to acknowledge the
contributions of the colleagues in FANTASTIC-5G and MAMMOET.
This work was presented in part at the IEEE International Conference on
Acoustics, Speech and Signal Processing (ICASSP), Shanghai, China, 2016.
in crowd scenarios, such as shopping mall or a stadium [6],
serving high density of devices that are closely spaced. The
scenario that sets the motivation for this article is the one
of massive Machine-Type Communication (mMTC), where
around 100 000 devices could be connected to a single BS.
Acquisition of channel state information (CSI) in massive
MIMO is critical, as a huge number of channel coefficients
have to be estimated per device. Time division duplexing
(TDD) offers a simplified CSI acquisition in a massive MIMO
system with a relatively small number of devices. Assuming
channel reciprocity, the channels are estimated at the BS
relying on uplink training based on orthogonal pilot sequences
and are then used for both uplink and downlink beamforming.
Hence, the length/number of the pilot sequences scales with
the number of devices and not the number of BS antennas.
In crowd and mMTC scenarios, the channel estimation faces
fundamental limits because of two specific features. First, the
number of pilot sequences is limited by the dimensionality of
the coherence interval of the channel, during which the channel
can be considered constant and flat. When the crowd of device
becomes very large, the orthogonal pilots are in severe short-
age and the allocation policy of the pilot sequences becomes
a central question. Second, the intermittence of the data traffic
also plays a significant role. In mMTC, each device sends
data to the BS sporadically, at random time instants. Since
not all devices are active simultaneously, the limited set of
orthogonal pilot sequences can highly likely accommodate the
subset of devices that are active at a particular instant. Hence,
pilot allocation has rather to adapt and scale with the traffic
activity pattern and not equal the actual number of devices
present in the system. A natural choice is to decentralize pilot
access to the devices and make it random, which leads to pilot
collision, also known as pilot contamination.
While massive MIMO is a fairly mature research topic [2],
[5], [7]–[10], the existing results on uplink capacity analysis
in the literature [9] assumes a pre-defined pilot allocation
and full data buffers at the devices. Those assumptions are
not applicable to the case we study here. A joint pilot and
data protocol based on random uplink access in a massive
MIMO system has been recently considered in [11], [12],
with the use of coded access and successive interference
cancellation (SIC). In [13], [14], a set of dedicated pilots
is temporarily allocated to the active devices, which in turn
apply random access to the pilot sequences in the set. This
leads to collisions, which are resolved by giving priority to
devices with good channels, while the data transmission is
carried out without pilot collisions. Both schemes [11]–[14]
ar
X
iv
:1
70
9.
01
34
7v
1 
 [
cs
.I
T
] 
 5
 S
ep
 2
01
7
2
rely on channel hardening. In [15], timing variations between
the devices are used to devise a random access scheme for
initial access, synchronization, and channel estimation. Some
preliminary results on the effect of intermittent device activity
can be found in [16].
In the approach proposed in this paper, transmission is
organized into transmission frames consisting of multiple
transmission slots. When an mMTC device has a data code-
word to transmit, it divides the codeword into multiple parts
and, within a transmission frame, transmits the codeword parts
in multiple transmission slots. The channels are estimated from
uplink pilots every time the device transmits. In each time
slot, each active device selects pseudo-randomly a pilot from
a predetermined pilot codebook and, during the rest of the slot,
it sends a part of the data codeword. Hence, a device performs
pilot-hopping over multiple slots and the hopping pattern can
be used to identify the device and appropriately merge and
decode the parts of its codeword at the BS. This approach
is suitable to harvest the large array gain for delay-tolerant
mMTC and low-power devices. It is important to note that our
access scheme relies on non-orthogonal pilot-hopping patterns,
each sequence consisting of orthogonal pilots. Another option
would be to build hopping patterns based on non-orthogonal
pilots and our scheme can be readily extended to that case.
When the number of transmission slots is sufficiently large,
the pilot collision events get averaged, so that we can define
a maximal achievable uplink sum rate. We determine a lower
bound on the sum rate that is tight thanks to channel hardening
and when the total number of terminals is large. This bound
is our main metric for performance assessment. Furthermore,
in order to optimize the system performance, the devices
are allowed to transmit with a certain activation probability
pa which is subject to optimization, along with the number
of training sequences. As the numerical evaluation of our
main performance bound can be cumbersome, optimization
is based on alternative bounds, tailored to account for rather
large variations in channel energy among the devices. We
provide a performance analysis for different asymptotic cases.
In particular, when the number of antennas M and the
duration of transmission slot ?u are of the same order, the
sum rate scales of
?
M?u. Heuristic solutions giving robust
performance results indicate that one third of the transmission
slot should be devoted to training while the average number
of active devices should be at the order of
?
M?u. Compared
to [17], we provide performance analysis and solutions for the
case where the channel energy varies across the devices.
The paper is organized as follows. Section II describes the
random access model, the communication protocol, and the
channel model. Section IV presents the main performance
bound, Section V the lower bounds used for optimization
and Section VI the heuristic solutions. In Section VII, scaling
laws are presented as a function of the number of antennas
at the base station and the duration of a transmission slot.
Section VIII contains numerical evaluations and is followed
by the conclusions.
II. SYSTEM MODEL
A. Random Access Model
We consider the uplink (UL) of a single-cell multi-device
massive MIMO system with random access from a large set of
intermittently active devices. The justification for a single-cell
model is found in Section II-D. The BS is equipped with M
antennas and serves a maximal number of K devices.
A total number of ?p orthogonal sequences are available,
denoted as {?1,?2, . . . ,??p}, where each sequence is ?p
symbols long. The duration of a pilot sequence is smaller than
the channel coherence interval. Moreover, K  ?p such that
the BS cannot allocate dedicated pilots to particular devices.
The system is assumed to be synchronized to maintain pilot
sequence orthogonality. It is important to note that an OFDM
system can tolerate timing mismatches provided that the cyclic
prefix is larger than the channel delay spread and the maximal
timing mismatch. Such conditions could be satisfied in small
enough cells in LTE as the normal cyclic prefix is designed for
a 750 m cell radius and the extended cyclic prefix corresponds
to a 2.5 km cell radius.
A UL transmission frame, see Figure 1, is divided into
transmission slots of duration ?u, where ?u is less or equal
to the channel coherence interval. Due to the random access,
the BS does not know a priori for a given slot which devices
transmit or which pilots are activated. Instead, each device
is associated to a unique, predefined pseudo-random pilot-
hopping pattern such that an active device selects the pilot
for a given transmission slot according to this pattern. The BS
knows in advance the pilot-hopping patterns of all potential
transmitters, such that it can buffer the information from
different slots, run a correlation decoder across the slots and
find out which pilot-hopping patterns have been activated.
When a device has data to send, it encodes it into codewords,
so that one codeword is sent within a given transmission frame.
Each codeword is divided into multiple parts and sent over
multiple time slots within the transmission frame. The number
of codeword parts is equal to the number of pilot sequences
in the pilot-hopping identifying patterns. Transmission from
the K devices is sporadic and a device is active within a
given transmission frame with activation probability pa, inde-
pendently from the other devices. An active device transmits
in all transmission slots of a transmission frame. Within a
transmission frame, a device is active only when it has data
to transmit.
In each active UL transmission slot, the pilot phase is
followed by a data phase, i.e., transmission of a part of a
codeword. Collisions can thus happen in the pilot domain, i.e.,
among contending devices that send the same pilot sequence to
the BS. Pilot collision is in fact similar to pilot contamination
in conventional massive MIMO and induces interference in
the data domain from the set of contaminators.
For an asymptotically large number of time slots, the whole
codeword is affected by an asymptotically large number of
channel fading realizations, pilot collision-induced interfer-
ence and other interference events. Relying on the ergodicity
of such a process, the system performance can be characterized
as in Section IV. Both the activation probability pa and the
3
Fig. 1: Illustration of the transmission frame. In this example,
four devices {D1, D2, D3, D4} and two mutually orthogonal
pilot sequences {?1,?2} are considered. Transmission of a
codeword is done over multiple channel fades, which enables
averaging over noise, channel fades, and pilot collision events.
number ?p of pilots per slot are optimized as elaborated in
Section V.
We model the process of constructing of a pseudo-random
hopping sequence by having each active device in each slot
select randomly one of the ?p sequences. Hence, the probabil-
ity of having Ka active devices within a total of K devices
that become independently active with probability pa is
p(Ka) =
(
K
Ka
)
pKaa (1? pa)Ka?K . (1)
The average number of active devices is paK and its variance
is paK(1 ? pa). Given a number of Ka active devices and
considering one given device 0 among the Ka active devices,
the probability of having c colliders to device 0 can be
expressed as the probability that c devices select the same
sequence as device 0 in a population of Ka ? 1, i.e.,
p(c|Ka) =
(
Ka?1
c
)(
1
?p
)c(
1? 1
?p
)Ka?c?1
. (2)
B. Channel Model
A block fading model is adopted where a channel realization
is constant across a transmission slot duration and changes
independently from slot to slot. A transmission slot is defined
as a time-frequency interval that is smaller than the coherence
time and coherence bandwidth of the channel. In our model,
the received signal is divided by the standard deviation of the
receive additive noise, so that the normalized M × 1 receive
noise vector n at the BS is modelled as n ? CN (0, IM ). The
channel response between the BS and device j is described
by an M × 1 channel vector gj . The channel realizations
are modeled as circularly symmetric complex Gaussian dis-
tributed: gj ? CN (0, ?jIM ). The variance ?j reflects the path
loss, shadowing, transmit power (relative to the received noise
power). One given parameter ?j is assumed invariant during
the whole transmission frame.
The devices transmit with different powers: device j trans-
mits with power pj during both the training and data phase. We
recall that the parameter ?j incorporates the transmit power
pj . Three models are considered for the distribution of ?j .
In the first two models, power control (performed during the
initial access phase [14], [18]) is assumed, meaning that the
transmit power from each device is adjusted so that all the
?j’s are equal.
Model 1: ?j = ?1(1 + v), where v is uniformly distributed
between ?? and ?, with 0 ? ? ? 1. It is assumed that
an imperfect power control is performed so that there
is an error around a nominal value ?1. This model was
chosen as large variations of ? do not change significantly
the optimization in Section VII, while the following two
models do.
Model 2: ?j = ?210v/10 or 10 log10(?j) = 10 log10(?2)+ v,
where v is modelled as a Gaussian random variable with
variance ?2v . In this model, the parameter ?j follows a
log-normal distribution, i.e. the conventional distribution
for shadowing. Power control is performed so that the
mean of the logarithm of ?j is the same for all devices.
Model 3: ?j = ?3(d/d0)??p , d = d0(1 + v), where v is
uniformly distributed between ?? and ?, with 0 ? ? ?
1. Parameter d0 is set to 500 meters and ?p = 3.76.
This model accounts for the path loss when devices are
distributed uniformly around a nominal distance from the
cell center.
In the simulations, ?1 = ?2 = ?3 and ?j is set to 10 dB. As will
be made clear in Section V, the final results do not significantly
depend on the values selected for ?1, ?2, ?3, provided we are
in interference-limited scenarios. Furthermore, we introduce
the notations E[?j ] = ?, E[?2j ] = ?2, E[?4j ] = ?4. Note that
? is equal to ?1 for Model 1 but not to ?2 or ?3 for Model 2
and Model 3.
We use (·)?, (·)T , (·)H , E[·] to denote complex conjugation,
transpose, Hermitian transpose, and the expected value of a
random variable, respectively.
C. Training Phase
During the training phase, the active devices send the
normalized pilot training sequences ?k, ?Hk ?k = 1, of length
?p. These sequences are orthogonal: ?Hk ?k? = 0, for k 6= k?.
The M × ?p matrix of the received pilot signals at the BS is
Yp =
?
?p
Ka?
k=0
gk?
T
k + Np, (3)
where Ka is the number of active devices in a given slot and
Np is an M × ?p matrix whose columns are the noise vectors
during the training phase.
One given device, device 0, is affected by a set of con-
taminators denoted as C0, which use the same pilot sequence
that we generically denote as ?[0], i.e. ?[0] = ?j , j ?
{1, · · · , ?p}.
D. Multi-Cell Operation
The main line of work on massive MIMO, starting from [1],
has assumed that all devices in a given cell use orthogonal
pilots and analyzed the system performance under inter-cell
pilot collisions due to pilot reuse across cells. Our main
assumption is that intra-cell pilot collision happens because
the crowd of devices calls for random pilot access. This
assumption is by itself a departure from the conventional
4
multi-cell interference models. Note that [19] considers inter-
cell pilot contamination in the sense that it provides a pilot
reuse plan within a cell so that users with very different
spatial characteristics use the same pilot, hence suppressing
pilot contamination. In contrast, our system is uncoordinated
with no specific assumptions of the channel properties, so the
intra-cell pilot contamination can be strong. Concerning the
inter-cell pilot collision, there are two possibilities.
• One possibility is to assign orthogonal pilot sets to each
cell where the sets are also orthogonal across neighboring
cells, so that one can neglect the inter-cell pilot collision.
This protocol has the disadvantage of decreasing the
number of available orthogonal pilot sequences per cell
for a given pilot sequence length, as the orthogonal
sequences are distributed across cells. The advantage is
that pilot contamination can be better controlled when it is
confined to a cell as opposed to multiple cells. This model
is equivalent to the single-cell model in Section II-A as
far as inter-cell pilot contamination is concerned. In data
transmission mode, inter-cell interference is present.
• The other possibility is to have the whole set of or-
thogonal sequences available in each cell, resulting in
inter-cell pilot collision. Assuming the same activation
probability in all the cells and a uniform spatial coverage,
the difference with a single-cell model is:
– The distribution of channel gains {?j}. Model 3 can
still be applied to multiple cells as it is based on
distance to the BS of interest. However, it is not the
case for Model 1 and Model 2 as the underlying
parameters take as reference the cell the device belongs
to. The distribution would be different for the devices
in the cell and the devices in the interfering cells.
– The sum rate involves only the devices in the cell of
interest.
In this paper, we focus on a single-cell model. As the random
access protocol presented in this paper is new, an initial anal-
ysis based on this simplified model is necessary to understand
the main mechanism behind the protocol. The study of a multi-
cell system as presented above is left for future work.
III. RANDOM ACCESS PROTOCOL
The pilot and data random access protocol at the BS is
outlined in Section III-A. It relies on the channel estimation,
device identification and decoding procedure presented in
Sections III-B, III-C and III-D.
A. Protocol Description at Receiver
The following procedure is considered for the transmission
of one codeword per device within a transmission frame. The
notations are defined in Section III-B.
Step 1: Multiple slot processing.
For one transmission slot, the following processing steps are
performed:
1) Pilot sequence detection: The BS detects which pilot
sequences are in use. This is done by correlating the
received signal Yp in (3) with each sequence ?j that
is available: Yp??j , j = 1, . . . , ?p. Pilot j is detected if
?Yp??j?, j = 1, . . . , ?p is larger than a pre-determined
threshold and nondetected otherwise. The pilot detection
outcomes are buffered in order to be utilized for device
activity detection, see Step 2.
2) Channel estimation: For each pilot sequence detected,
a scaled version of the MMSE channel estimate is deter-
mined. This estimate is the same for all members of a
contamination set.
3) Multi-antenna processing: For each pilot sequence de-
tected, Maximum Ratio Combining (MRC) is applied
to the data symbols in the slot and the MRC output is
buffered along with its associated pilot index.
4) End of transmission: The process is repeated until all
active devices have stopped transmitting their codeword.
End of transmission is jointly detected with the active
device identification.
Step 2: Active device identification. From the pilot-hopping
patterns detected across the multiple slots at Step 1, the
transmitting devices are detected.
Step 3: Decoding. Based on the identified pilot patterns, the
BS identifies which MRC outputs to combine to decode the
data of each transmitting device. For each identified device 0,
data decoding assumes the knowledge of ?0.
B. MMSE Channel Estimation
The MMSE estimation of g[0] proceeds first by correlating
Yp with the pilot sequence ?0 to obtain
yp = Yp?
?
[0] =
?
?p
?
j?C0
gj + Np?
?
[0]. (4)
The MMSE estimate of g0 is then [20]
g?0 =
(
E[ypyHp ]
)?1 E[h0yHp ] yp = ?2h0yp?2ypyp yp, (5)
where E[ypyHp ] = ?2ypypIM and E[h0y
H
p ] = ?
2
h0yp
IM , with
?2ypyp = ?p?0 + ?p
?
j?C0
?j + 1, (6)
?2h0yp =
?
?p?0. (7)
The following results will be used in the computation of the
performance bound in Section IV-B. For j ? C0
g?j =
?j
?0
g?0, E[g?0g?H0 ] = ?2g?0IM , ?
2
g?0 =
?4h0yp
?2ypyp
(8)
E[?0?H0 ] = ?2g?0IM ,
?2g?0 = ?0 ?
?4h0yp
?2ypyp
=
?p
?
j?C0 ?j + 1
?2y0y0
. (9)
where ?0 = g?0 ? g0.
We define the quantity g??0 as:
g?0 = ?0g?
?
0, g?
?
0 =
?
?p
?p
?
j?{0,C0} ?j + 1
(10)
5
We use g??0 as a basis for the MRC operation at each transmis-
sion slot (see Section III-A).
The sum power
?
j?{0,C0} ?j can be estimated accurately
as detailed in [14]: indeed, using channel hardening, as the
number of antenna grows large, the term ?Tj Y
H
p Yp?
?
j is
asymptotically equal to ?2ypyp = ?p
?
j?{0,C0} ?j + 1. Then,
for each pilot sequence detected, the corresponding channel
estimate g??0 is computed using (10).
C. Active Device Identification
Each pseudorandom pilot-hopping pattern serves as a
unique signature/identification for the device that applies that
pattern. The device patterns are known a priori to the BS, such
that the BS combines the pilot sequence detection outcomes
from the slots that follow the pattern in order to detect the
transmitting devices. The pseudorandom pilot-hopping pattern
detection follows the same principle as pseudorandom CDMA
sequence detection. We assume that the number pilot hopping
sequences is sufficiently large so that every user in the cell
has a unique identifying sequence.
D. Decoding Procedure
The MMSE channel estimate of device 0 requires knowl-
edge of parameter ?0 which cannot be assigned to device
0 until it is identified. To overcome this limitation, data
decoding is performed as follows. At first, the BS obtains,
for each transmission slot, the output of the MRC receiver
based on the channel estimates g??0 defined in (10) which
are estimated at each transmission slot. A pilot sequence
is linked to each of the MRC output at each transmission
slot. MRC is attractive in massive MIMO due to its low
computational complexity and asymptotic rejection of non-
coherent multi-device interference and noise [7]. Next, the BS
identifies a transmitting device through its identifying pseudo-
random sequence from which it can associate the relevant
MRC outputs over the multiple transmission slots. We assume
that the BS knows the associated ?0 parameter (based on the
initial access phase [14], [18]) and can estimate
?
j?{0,C0} ?j
based on equation (4) (using channel hardening as in [14]).
The BS performs soft combining of the MRC outputs scaled
by ?0.
IV. UPLINK SUM RATE
A. Maximal Achievable Sum Rate and Main Assumptions
Within a transmission frame, the codeword of a given device
experiences all possible contamination events from the Ka
active devices, provided that the number of transmission slots
is sufficiently large. Likewise, for an asymptotically large
number of transmission slots, a device experiences an asymp-
totically large number of additive noise and fading realizations.
Under those asymptotic conditions, a maximal achievable rate
per device can be defined within each transmission frame.
Achieving this rate assumes the following features:
1) The number of active devices within a transmission frame
can be estimated at the BS.
2) The average channel energy ?j per device j can be
estimated at the BS and at the device.
3) Under conditions 1) and 2), the BS can compute a
maximal achievable rate per device. The BS broadcasts
both the channel energy ?j and the associated rate for
each active device. As the device itself knows its channel
energy, it can associate the corresponding rate.
The different performance metrics presented in this paper
correspond to the maximal achievable sum rate averaged over
the activation probability of the devices.
We present two types of bounds on the average maximal
achievable sum rate. First, the main bound R1 in (14) tightly
approximates the maximal achievable sum rate and is used
for performance assessment. It necessitates Monte-Carlo sim-
ulations of the channel large scale fading realizations (i.e.,
?). Its numerical evaluation can be heavy as it involves the
computation of expected values over binomial distributions
with large number of devices K. A secondary bound,R2, does
not require Monte-Carlo simulation but its tightness depends
on the distribution of the parameters {?j}. Other boundsR3 in
(20) and Ra in (21) are developed and serve as optimization
tools. They are relatively loose, but analytically simple and
follow the variations of the ergodic sum rate well. Those
bounds are the basis for the heuristic solutions presented in
Section VI.
B. Main Performance Bounds
Here we present the main bound R1 that is used for per-
formance assessment. A secondary bound R2 is also provided
and mainly helps in establishing bound R3 in Section V.
Theorem 1 (Main bound R1). An approximation of the
average maximal achievable sum rate (in bits per symbol) is
R1 =
K?
Ka=1
p(Ka)Ka
Ka?1?
c=0
p(c|Ka) E? [R1 (C0,Ka, {?})] (14)
where
R1 (C0,Ka, {?}) =
?u ? ?p
?u
log2
(
1 + SINR1(C0,Ka, {?})
)
(15)
is a lower bound on the maximal achievable rate of device 0
conditioned on a collider set with indices C0 and Ka active de-
vices. The expectation is taken with respect to ?j , j ? {0, C0},
denoted as {?}. SINR1(C0,Ka, {?}) is given by (11) at the
top of the next page.
Recall that p(c|Ka) is the probability of having c colliders
to device 0 when Ka devices are active and is given in
Equation (2). p(Ka) is the probability of having Ka active
devices out of K and is given in Equation (1).
Proof. See Appendix A.
The computation of the sum rate involves averaging w.r.t.
the specific realization of the ?’s during the whole transmis-
sion frame and computing quantities related to all possible
sets of different size among the K devices (See Appendix A).
As it is prohibitively complex, we instead compute an ap-
proximation (14) where the expected value w.r.t. the discrete
probability functions is replaced by an expected value w.r.t.
6
SINR1(C0,Ka, {?}) =
?p(M?1)?20
?p(M?1)
?
j?C0
?2j+
?
i?{0,C0}
?i(1+?p
?
j?Ci
?j)+(1+
?
i/?{0,C0}
?i)(1+?p
?
i?{0,C0}
?i)
(11)
SINR2(c,Ka, ?0) =
?p(M?1)?20
?p(M?1)?2c+?0(1+?pc?)?c?
2
?p+(1+(Ka?1)?)(1+?0?p+?pc?)
(12)
SINR3(?0)=
?p(M?1)?20
?2(M?1)(paK?1)+?0(1+?(paK?1))??
2
(paK?1)+(1+(paK?1)?)(1+?0?p)+(paK?1)?+?
2
(p2aK(K?1)?(paK?1))
(13)
continuous probability functions. As K becomes large, the
approximation becomes very good. The results show that R1
approaches a limit when K ??.
Furthermore, after a certain threshold on K, R1 does not
increase significantly. This can be understood as the tail
of the binomial distribution becomes very small for large
values of K and brings the associated expected value of term
Ka
?Ka?1
c=0 p(c|Ka) E? [R1 ({?}, C0|Ka)] in (14) to zero.
This result also means that after this threshold, the individual
rate per device diminishes.
Under the assumptions described in Section IV-A, device 0
computes its transmission rate as
R0 =
1
M
K?
Ka=1
p(Ka)Ka
Ka?1?
c=0
p(c|Ka) E{?}\?0 [R1 (C0,Ka, {?})] (16)
where E{?}\?0 designates the expectation w.r.t. {?k, k 6= 0}.
C. Secondary Performance Bounds
The next bound R2 is a secondary bound that is used as a
basis for the bounds in Section V. Using Jensen’s inequality
on log2(1 + 1/x), a lower bound is obtained by taking the
expected value of the denominator in (12) w.r.t. all sets
of contaminators to device 0. The main advantage of R2
compared with R1 is that the equivalent SINR, SINR2(?0), in
(12) can now be explicitly written as a function of the number
of contaminators to device 0 and number of active devices.
Theorem 2 (Secondary bound: R2). A lower bound on R1
(in bits per symbols) is
R2 =
K?
Ka=1
p(Ka)Ka
Ka?1?
c=0
p(c|Ka)E?0 [R2(c,Ka, ?0)] (17)
where
R2(c,Ka, ?0) =
?u ? ?p
?u
log2(1 + SINR2(c,Ka, ?0)) (18)
and SINR2(c,Ka, ?0) is shown in (12) at top of the next page.
p(c|Ka) and p(Ka) are defined in (1) and (2).
In (17), we maintain the expected value w.r.t. ?0 outside
of the log term, as its impact is not easily captured through
simplifying tools like Jensen’s inequality, if the ?’s have
a large variance across the device population. Note that
SINR2(c,Ka, ?0)) is a fraction depending on ?0 and ?
2
0 and
its integral w.r.t. ?0 can be written as a closed form expression,
so that E?0 [log2(1 + SINR2(c,Ka, ?0))] can be written in
closed form for Model 1, i.e., a uniform distribution of ?.
V. BOUNDS FOR OPTIMIZATION AND PERFORMANCE
ANALYSIS
We now determine the values of the activation probability
pa and the pilot sequence length ?p that maximize the perfor-
mance bound R1. As the numerical evaluation of R1 is heavy
for large values of K, we use two lower bounds on R1 that are
the main bounds used for optimization as well as performance
analysis. Such an optimization assumes the knowledge of the
distribution of the ?’s. As paK is in fact the optimization
parameter, the knowledge of the total number of devices K is
not necessary for the optimization itself, but it is necessary to
decide the reliable rate for each device.
We mostly treat the case where ?p is not linked to an actual
channel, meaning that we do not integrate in the optimization
problem that the constraint ?p should be smaller than the
coherence time or is limited by the transmit power of the
devices. The main results from the latter case are mentioned
in Appendix B. Furthermore, as mentioned in Section II-B, we
assume that a device always has data to transmit at activation
time. To summarize, the optimization problem is:
max
0??p??u,0?pa?1
Ro(?p, pa). (19)
Ro denotes generically the different cost functions considered
in Sections IV, V and VI.
In the next bound R3, the expectation is taken in the
denominator of (12) w.r.t. the distribution of the number of
contaminators and the number of active devices. The bound
R3 is relatively loose as compared to R1 and R2, since it
averages over the number of colliders and active devices in
the interference variances. However, R3 follows very well the
variations of R1 and provides very good optimization results
provided that the variance of the parameter ? is not too large.
This aspect is highlighted in the numerical results section.
Theorem 3 (Bound for optimization: R3). A lower bound on
R1 (in bits per symbol) is
R3 =
?u ? ?p
?u
paK E?0 [log2(1 + SINR3(?0))] (20)
where SINR3(?0) is given in (13) at the top of the next page.
Proof. In the denominator of SINR2, we take the expected
value w.r.t. the probability mass of the binomial distribution
p(c) = p(Ka)p(c|Ka). More specifically, we take first the
expected value of c conditioned on a number of active devices
Ka. It is the average number of contaminators to one given
device and is equal to (Ka?1)/?p. Then, we take the expected
value w.r.t. Ka, i.e., the average number of active devices out
7
of K devices which is equal to paK. Hence, E[c] = (paK ?
1)/?p. We obtain a lower bound on the ergodic rate of a single
device. Next, we multiply by the average number of devices
paK.
From (13), a simpler bound can be deduced given asymp-
totic conditions on the parameters for which we keep the
equivalent expression of SINR3(?0).
Asymptotic bound: Ra. If K  1, ?u  1, M  1, ?p  1
and paK  1, a lower bound on the ergodic sum rate is
Ra = paK
?u ? ?p
?u
E?0 [log2(1 + SINRa(?0))] , (21)
SINRa(?0) =
M?p?
2
0
?2MpaK + ?
2
p2aK
2 + ??0paK?p
. (22)
The expression of SINRa(?0) allows for an easy identifi-
cation of the different terms and their effect. For that purpose,
we rewrite SINRa(?0) as
1
SINRa(?0)
=
?2paK
?p?20
+
?
2
p2aK
2
M?p?20
+
??0paK
M?20
. (23)
The first term in the sum comes from interference induced
by pilot collision. The second and third terms come from the
residual multi-device interference left by MRC.
We illustrate the variations of Ra in Figure 2 as a function
of ?p and paK, for M = ?u = 100 and no variations across the
?’s (or perfect power control). For fixed paK, the sum rate
first increases as ?p increases since the probability of pilot
collision decreases. Hence, the first and second interference
terms decrease. Then, the rate penalty ?u??p?u coming from
longer pilot sequences results in a sum rate decrease.
For a fixed number of pilot sequences ?p, the sum rate
first increases through the pre-log term: the number of devices
increases faster than the SINR decreases from increased inter-
ference. When the decrease of the SINR becomes too large,
the sum rate decreases. This decrease comes from the multi-
device interference term ?
2
p2aK
2
M?p?20
. This last observation will be
the basis of heuristic solution (26) in Section VI.
VI. HEURISTIC SOLUTIONS
In this section, we present heuristic solutions to our opti-
mization problem. To simplify the notations, we employ the
superscript ()o to denote the solutions of the optimization
problem regardless of the optimization cost function.
A. Small variations of {?}
Consider Model 1 and Model 3 in Section II-B with ? 1.
A Taylor approximation of the log term in (21) is of the form
log2 (1 + SINRa(?0)) = log2(1+SINRa(?))+c1?+O(?
2),
where c1 is a scalar involving all the parameters except ?.
Therefore, E?0 [log2(1+SINRa(?0)] = log2(1+SINRa(?))+
O(?3). The same kind of derivation also holds for Model 3.
We note that the approximation error is of order ?3, which
explains why the approximation is quite robust to values of ?
that are not strictly speaking “small”, as seen in the numerical
Average number of users p
a
 K
N
um
be
r 
of
 p
ilo
t s
eq
ue
nc
es
 ?
p
Asymptotic rate R
a
 (bits/symbols)
 
 
100 200 300 400 500 600 700 800 900 1000
50
100
150
200
250
300
350
400 0
10
20
30
40
50
60
Fig. 2: Ra as a function of ?p and paK for M = ?u = 400.
results. For Model 1, we found that the performance and
optimization are quite insensitive to large values of ?. For
Model 3, a value of ? = 0.25 results in optimized performance
that is close to the ones with perfect power control (? = 0),
while, for Model 2, this value is ? = 0.1.
For small variance in ?’s, the approximate cost function is
Ra ? paK
?u ? ?p
?u
log2(1 + SINRa(?)). (24)
In Section V, we noted that the variations of Ra depend on
the term in p2aK
2 in the denominator of SINRa. The heuristic
solution presented next is obtained based on (24) where only
the term in p2aK
2 is kept.
Heuristic Solution 1. A heuristic solution to the optimization
of parameters ?p and pa maximizes the modified cost function
R[0]h = paK
?u ? ?p
?u
log2
(
1 +
M?p
p2aK
2
)
. (25)
The solution is
?op =
?u
3
poaK =
?
?uM?
3s0
(26)
where s0 ? 3.92 is the solution of log(1 + x) = 2 x1+x .
Proof. We look for the expression of ?p and paK maximizing
the following rate function:
Rh = paK(?u ? ?p) log2(1 +X), X =
M?p
?
2
??2p2aK
2
. (27)
The partial derivative of Rh are{
?Rh
??p
= ? log2(1 +X) + (?u ? ?p) ?X??p
1
1+X ,
?Rh
?pa
= log2(1 +X) + pa
?X
?pa
1
1+X .
(28)
Noting that pa ?X?pa = ?2X and
?X
??p
= 1?pX , we obtain{
1 + 1+XX log(1 +X) =
?u
?p
,
1+X
X log(1 +X) = 2.
(29)
From those equations, we obtain (26).
An advantage of (24) is that it does not depend on the
statistics of the ?’s, such that they need not to be known.
8
B. Large variations of {?}
For large values of ?, the performance of the solution
previously described degrades. We observe that the optimal
solution involves a larger average number of active devices
paK while ?u/3 remains a good approximation for ?p. In the
following heuristic solutions, we set ?op = ?u/3, while paK is
optimized based on Ra or heuristic R[0]h . The superscript 1D
below indicates that the optimization is now one dimensional.
Asymptotic 1D. A heuristic solution to the optimization of
parameters ?p and pa is
?op =
?u
3
poaK = b
o
?
?uM (30)
where bo maximizes the sum rate Ra where ?p is set to ?u/3:
R[1D]a =bE?0 log2
(
1 +
?
M?u?
2
0/3
b?2M + b2?
2?
M?u + b??0?u/3
)
(31)
bo depends on M , ?u and the statistics of the ?’s.
Heuristic Solution 2. A heuristic solution to the optimization
of parameters ?p and pa is
?op =
?u
3
poaK = b
o
?
?uM (32)
where bo maximizes the heuristic cost function (26) where ?p
is set to ?u/3:
R[1D]h = b E?0
[
log2
(
1 +
?20
3?b2
)]
(33)
bo does not depend on M or ?u but solely on the statistics of
the ?’s.
VII. SUM RATE SCALING LAWS
In this section, we give a summary of the scaling laws of
the optimized sum rate and optimized parameters based on
Ra and (19). As seen through numerical results, Ra-based
optimization gives results that are close to direct optimization
based on R1, provided that the variance of the ?’s is not
very large. Hence such an analysis makes sense under such
conditions. The details can be found in Appendix B.
Scaling Laws. Assuming ?u  1, M  1, the scaling laws
of the optimized sum rate Ra and optimized parameters ?op
and poaK are summarized as follows. Parameter ?p is not
constrained by the channel coherence time.
Case 1: M  ?u:
?op ?
?u
2
+O
(
?u
?
?u
M
)
(34)
poaK ?
?
?4
?
2
?2
1
2
?
M?u +O(?u) (35)
Roa ?
?u
4 log(2)
+O
(
?u
?
?u
M
)
(36)
SINRa ?
?
?u
M
+O
( ?u
M
)
(37)
Case 2: M  ?u:
?op =
(
M
2
)2/3
?1/3u + o(?u), (38)
poaK =
?
?4
?
2
?2
(
M
2?u
)5/6
+O(M) (39)
Roa =M +O
(
M
[
M
?u
]2/3)
(40)
SINRa = 2
1/3
(
M
?u
)1/6
+O
([
M
?u
]1/3)
(41)
Case 3: M ? ?u:
?op = a?u, p
o
aK = b
?
M?u, a = O(1), b = O(1) (42)
Roa = O(
?
M?u), SINRa = O(1) (43)
In Case 1, the average number of active devices and the
sum rate is limited by ?u. In Case 2, it is is limited by M .
In Case 3, the optimal number of pilot sequences and average
number of active devices become comparable. In Case 1 and
Case 2, the rate of each device becomes asymptotically small
but the average number of active devices that the system can
accommodate grows faster. In Case 3, the rate of each device
becomes constant while the average number of active devices
increases. The quality of service requirement should dictate
the choice of M and ?u.
In Case 1 and Case 2, we notice that the optimization results
depend on the distribution of the parameters ? through the
factor ?
4
?
2
?2
. In Model 1, this factor has a small value range
even for a wide range of values of ?. Hence, for this model, the
optimization will not significantly depend on the distribution
of the ?’s. On the other hand, for Model 2 and Model 3,
the factor ?
4
?
2
?2
varies significantly with varying values of ?2v
and ? and so do the optimized values. For Case 3, we notice
the same kind of behavior via simulations. Note that all those
points are detailed in the simulation section.
VIII. NUMERICAL RESULTS
In this section we illustrate the performance of the random
pilot and data access protocol at optimized value of ?p and
paK. Due to the computational limitations in evaluating R1,
the value of K is not as large as could be expected in an
mMTC scenario. However, the value of K is chosen so thatR1
is close to its limit when K grows to infinity (see Section IV)
so that our results are still representative. Furthermore, ?u and
M are chosen to be of the same order.
The curves show three different metrics as a function of
the transmission slot duration ?u and for a fixed number of
antennas M . The metrics are evaluated using the different
optimization methods described in the previous sections. The
metrics are: (1) Rate R1 in bits per symbols; (2) The optimal
number of pilot sequences; (3) The optimal activation proba-
bility through the quantity poaK, i.e., the average number of
active devices. For easy reference, the different optimization
methods are summarized here:
1) R1-opt: direct optimization based on the main bound R1.
9
0 100 200 300 400 500 600 700 800
Transmission slot duration ?
u
0
10
20
30
40
50
60
Average sum rate - Model 1
K=800, ?=0
K=400, ?=0.25
K=400, ?=0.5
K=600, ?=0.25
K=600, ?=0.5
K=800, ?=0.25
K=800, ?=0.5
K=1000, ?=0.25
K=1000, ?=0.5
Fig. 3: Model 1. Optimal sum rate R1, for M = 100, K =
{400, 600, 800, 1000}, ? = {0, 0.25, 0.5}.
2) R3-opt: optimization based on bound R3.
3) Ra-opt: optimization based on asymptotic bound Ra.
4) R[1D]a -opt: ?op is fixed to ?u/3, poaK determined from Ra.
5) R[0]h -opt: ?op = ?u/3, poaK =
?
?uM/
?
3s0 in (26).
6) R[1D]h -opt: ?op = ?u/3, poaK is based on the heuristic rate
function R[1D]h in (33).
In all the figures, except Figure 8, the number of antennas is
M = 100. We show performance for perfect power control
and different values of the variance of the ?’s. For Model 1,
we show only one curve as performance is quite insensitive
to the variance of the ?’s. Model 2 and Model 3 exhibit the
same kind of behavior and we only show performance for one
of the models to illustrate one particular performance aspect.
A. Optimization of Main Bound R1
We first show performance results with direct optimization
of R1. Our main purpose is to show the variations of the
optimized points w.r.t. the distribution of the ?’s and w.r.t. to
total number of devices K. Those points are highlighted in
Section IV-B and VII. The heavy computations involved in
the numerical evaluations have imposed a limit on the number
of Monte-Carlo runs on parameters {?j} in (14). Hence,
some curves fluctuate but still indicate significant performance
results.
In Figure 3, for Model 1, the optimal sum rate is shown
for the case of perfect power control (? = 0) and ? = 0.25,
? = 0.5 for different values of the total number of devices
K. We see that performance is insensitive to the values of
parameters ? and K. The optimized values of ?p and paK
are also approximately the same.
In Figure 4, for Model 2, the optimal sum rate is shown for
?2v = 0 and ?
2
v = 0.5, i.e., a large variation of the variance,
for different values of the total number of devices K. As
0 100 200 300 400 500 600 700 800
Transmission slot duration ?
u
0
10
20
30
40
50
60
O
pt
im
al
 s
um
 r
at
e 
(b
its
/s
ym
bo
l)
Optimal sum rate - Model 2
K=800, ?=0
K=400, ?=0.5
K=800, ?=0.5
K=1000, ?=0.5
Fig. 4: Model 2. Optimal sum rate R1, for M = 100, K =
{400, 800, 1000}, ?2n = {0, 0.5}.
mentioned in Section IV, there is K above which the rate
does not change significantly. In numerical evaluations that
are not shown in this paper, we also observed that the larger
the variance of the ?’s, the larger the number of devices to
reach this steady state.
In Figure 5, for Model 2, the sum rate curves, optimized ?p
and paK are shown for different values of ?2v and a large K =
1000. Performance degrades as ?2v increases. However, the
degradation is small, even with large ?2v . The optimal number
of pilot sequences appears quite insensitive to the variance of
?, while the optimal average number of devices increases with
the variance. The same was observed for Model 3.
B. Optimization Methods
We now show the performance metrics using the six dif-
ferent methods previously described. In Figures 6, the sum
rate and optimized ?p is shown for Model 3, ? = 0.25. In
Figures 7, for the same model, ? = 0.5, the sum rate and
optimized paK is shown. The total number of devices K is
equal to 800. For all the parameter settings that we tested, the
performance using R3 or Ra are almost the same, so that we
refer only to Ra from now on.
For the medium value ? = 0.25, Ra-opt follows closely
R1-opt. There is a slight degradation for the heuristic solutions
for larger values of ?u while heuristic solutions perform
slightly better for smaller values of ?u. This behavior is
confirmed and magnified for ? = 0.5. The optimal number
of pilot sequences tends to be overestimated compared to R1-
opt when the transmission slot duration becomes large. The
gap in the estimation of paK is quite large, but this does not
show significantly in the sum rate R1. This can be explained
by the fact that R1 is quite flat around the optimal point.
At last, we show a more extreme case, with M = 400,
Model 2 and ?2v = 0.25, where in the selected range of ?u, Ra
based methods perform significantly worse than the heuristic
methods. In such a case, power control is the preferred solution
as it leads to a robust and simple optimization. If power control
10
0 100 200 300 400 500 600 700 800
Transmission slot duration ?
u
0
10
20
30
40
50
60
O
pt
im
al
 s
um
 r
at
e 
(b
its
/s
ym
bo
l)
Optimal sum rate - Model 2
K=800, ?
v
2=0
K=1000, ?
v
2=0.25
K=1000, ?
v
2=0.5
(a)
0 100 200 300 400 500 600 700 800
Transmission slot duration ?
u
0
20
40
60
80
100
120
140
160
180
200
A
ve
ra
ge
 n
um
be
r 
of
 u
se
rs
Average number of users p
a
o K - Model 2
K=800, ?
v
2=0
K=1000, ?
v
2=0.25
K=1000, ?
v
2=0.5
(b)
0 100 200 300 400 500 600 700 800
Transmission slot duration ?
u
0
20
40
60
80
100
120
140
160
180
200
N
um
be
r 
of
 p
ilo
t s
eq
ue
nc
es
Optimal number of pilot sequences ?
p
o - Model 2
K=800, ?
v
2=0
K=1000, ?
v
2=0.25
K=1000, ?
v
2=0.5
(c)
Fig. 5: Model 2. (a) Optimal sum rate R1, (b) paK and (c)
?p, for M = 100, K = {800, 1000}, ?2n = {0, 0.25, 0.5}.
0 100 200 300 400 500 600 700 800
Transmission slot duration ?
u
0
10
20
30
40
50
60
O
pt
im
al
 s
um
 r
at
e 
(b
its
/s
ym
bo
l)
Optimal sum rate - Model 3, ? = 0.25
R1-opt
R
3
-opt
R
a
-opt
R
a
[1D]-opt
R
h
[0]-opt
R
h
[1D]-opt
(a)
0 100 200 300 400 500 600 700 800
Transmission slot duration ?
u
0
50
100
150
200
250
300
N
um
be
r 
of
 p
ilo
t s
eq
ue
nc
es
Optimal number of pilot sequences ?
p
o - Model 3, ? = 0.25
R1-opt
R
3
-opt
R
a
-opt
R
a
[1D]-opt
R
h
[0]-opt
R
h
[1D]-opt
(b)
Fig. 6: Model 3. (a) Optimal sum rate R1 and (b) ?p, for
M = 100, K = 800, ? = 0.25.
is not possible, it is clear that resorting to direct optimization
of R1 is preferable, while heuristic solutions could be of
significant value.
IX. CONCLUSION
Massive MIMO is recognized as a primary technology
in 5G for its ability to provide very high data rates. It is
also a major enabling tool for machine-type communications
where the sheer number of devices can be accommodated
relying on the high multiplexing gain of massive MIMO and
low-power devices can be served relying on its large array
gain. In this paper, we have proposed a joint pilot and data
transmission protocol based on random access that is adapted
to the intermittent activity pattern of the devices. This protocol
is organized in transmission slots and relies on the averaging
of the pilot collision events across the transmission slots.
It is suited for delay-tolerant and low-rate applications. We
have provided performance expressions as well as optimization
11
0 100 200 300 400 500 600 700 800
Transmission slot duration ?
u
5
10
15
20
25
30
35
40
45
50
55
O
pt
im
al
 s
um
 r
at
e 
(b
its
/s
ym
bo
l)
Optimal sum rate - Model 3, ? = 0.5
R1-opt
R
3
-opt
R
a
-opt
R
a
[1D]-opt
R
h
[0]-opt
R
h
[1D]-opt
(a)
0 100 200 300 400 500 600 700 800
Transmission slot duration ?
u
0
50
100
150
200
250
300
A
ve
ra
ge
 n
um
be
r 
of
 a
ct
iv
e 
us
er
s
Average number of active users p
a
oK - Model 3, ? = 0.5
R1-opt
R
3
-opt
R
a
-opt
R
a
[1D]-opt
R
h
[0]-opt
R
h
[1D]-opt
(b)
Fig. 7: Model 3. (a) Optimal sum rate R1 and (b) paK, for
M = 100, K = 800, ? = 0.5.
tools that are particularly important for a system where the
activity of the devices and the number of pilots have to obey
certain statistical rules.
APPENDIX A
PROOF OF THEOREM 1
The derivation of SINR1({?}) follows [5], [9]. The pre-log
term in (14) accounts for the activity probability of devices.
The main derivation steps are reported below.
A. Derivation of SINR1
We first compute the achievable sum rate for a fixed number
of active devices Ka. The M × 1 vectorial received signal in
the data phase is
yd =
Ka?
i=1
gkxk + n (44)
0 100 200 300 400 500 600 700 800
Transmission slot duration ?
u
0
20
40
60
80
100
120
140
O
pt
im
al
 s
um
 r
at
e 
(b
its
/s
ym
bo
l)
Optimal sum rate - Model 2, ?
v
2 = 0.25 - M=400
R
3
-opt
R
a
-opt
R
a
[1D]-opt
R
h
[0]-opt
R
h
[1D]-opt
Fig. 8: Model 2. Optimal average sum rate R1 for M = 400,
K = 800, ?2v = 0.25.
where xk is the transmitted symbol from device k and n is the
additive noise vector. We isolate the contributions with index
set {0, C0} and its complement and write gk as g?k??k, where
?k is the error vector in the MMSE estimation. The received
signal can be rewritten as
yd =
?
j?{0,C0}
(g?j ? ?j)xj +
?
j /?{0,C0}
gjxj + n (45)
The BS applies MRC based on channel estimate g?0 in (5):
g?H0 yd = g?
H
0 g?0x0 +
?
j?C0
g?H0 g?jxj + (46)?
j?{j,C0}
g?H0 ?jxj +
?
j /?{0,C0}
g?H0 gjxj + g?
H
0 n (47)
where g?H0 g?0x0 is the signal of interest. The other additive
terms are treated as a Gaussian noise. Using the independence
of ?j and g?0 in MMSE estimation, those terms are independent
from the signal of interest. From (8), the achievable rate is
R = E{hk} log2 (1 + SINR) (48)
where SINR is equal to
|g?H0 g?0|2?
j?C0
|g?H0 g?i|2 +
?
j?{k,C0}
|g?H0 ?i|2 +
?
j /?{k,C0}
|g?H0 gi|2 + ?g?0?2
. (49)
The notation E{hk} indicates the expected value w.r.t. small
scale fading terms hk, defined as gk =
?
?khk.
Following [9], using Jensen’s inequality on function
log2(1 + 1/x) allows averaging over the channel fast fading
of the interferers. We obtain a lower bound as:
R1({?}) = log2 (1 + SINR1({?})) (50)
where 1/SINR1({?}) is equal to?
j?C0?
2
j
?20
+
?
j?{0,C0}?
2
?j
(M ? 1)?2g?0
+
?
j /?{0,C0}?j + 1
(M ? 1)?2g?0
. (51)
12
Replacing the expression of ?2?j and ?
2
g?0
in (8) and (9), we
obtain (11).
The first term in (51) represents the interference induced by
pilot contamination, the second comes from channel estimation
errors and the third term comes is due to noise and residual
interference after MRC.
B. Derivation of the pre-log term
(50) gives a lower bound on the maximal achievable rate
of one given device 0 with a population of Ka active devices,
with exactly c contaminators and a given realization of the
?’s. This bound is tight compared to the maximal achievable
rate thanks to channel hardening. Next, we give the different
steps leading to (14). Note that when the notations become
too heavy and when there is no ambiguity, we give up the
dependency w.r.t. the parameters. Furthermore, the notations
in equations (14) and (15) have been simplified compared to
the notations adopted in this appendix.
• We compute the achievable rate for device 0 averaged
over the possible sets of contaminators within the set of
Ka ? 1 active devices excluding device 0. This last set
is denoted as K0a({?}) and the set of contaminators is
denoted as C0(c,K0a({?})). The rate is
EC0
[
R1
(
?0, C0(c,K0a({?}))|K0a({?})
)]
(52)
where EC0 represents the expected value w.r.t. all possible
sets of c contaminators within K0a.
• Next, we compute the expected value of (52) accounting
for the random selection of the pilot sequences within the
set K0a and obtain
Rc1=
Ka?1?
c=0
p(c|K0a)EC0
[
R1
(
?0, C0(c,K0a({?}))|K0a({?})
)]
(53)
where p(c|K0a) is the probability of having c contamina-
tors to device 0 within the set K0a.
• Next, we compute the expected value of (53) accounting
for the activation probability, i.e., the probability to have
Ka ? 1 active devices within a total number of K ? 1
devices (as device 0 is excluded). We get
K?
Ka=1
p(Ka ? 1|K ? 1)EK0a [R
c
1] (54)
where EK0a represents the expected value w.r.t. all possi-
ble sets of Ka ? 1 active devices excluding device 0.
• Now, accounting for the activation probability pa of de-
vice 0 and noting that pap(Ka?1|K?1) = KaK p(Ka|K),
the achievable rate for device 0 averaged over the con-
tamination events and activation probability is
R01(?0)=
1
K
K?
Ka=1
p(Ka|K)Ka
Ka?1?
c=0
p(c|K0a)EK0a,C0 [R1] (55)
• Finally, the sum rate is
?K
k=1R
0
1(?k) equal to
K?
Ka=1
p(Ka|K)Ka
Ka?1?
c=0
p(c|K0a) (56)
1
K
K?
k=1
EKka,Ck
[
R1
(
?k, Ck(c,Kka({?}))|Kka({?})
)]
(57)
• We make the approximation
1
K
K?
k=1
EKka,Ck [R1] ? E{?}[R1] (58)
where E{?} is the expected value of all ?ks with k 6= 0
w.r.t. their probability density function. Given that the
?k’s are all independent, this approximation becomes
better as K grows large. Expression (58) gives us (14).
APPENDIX B
SCALING LAWS
An asymptotic analysis is performed with the three cases:
• Case 1: M  ?u, i.e., ?u/M close to 0.
• Case 2: M  ?u, i.e., M/?u close to 0.
• Case 3: M ? ?u, i.e., M and ?u are of the same order.
The analysis is directly based on the asymptotic expression
of the sum rate Ra in (21), instead of R3, which is justified
by examining the asymptotic conditions ?u  1 and M  1
and the ones considered below. Most of the results are based
on first or second order Taylor approximations. To ease the
presentation, we write the order of the approximations only
for the final optimized quantities. Furthermore, ?p is not
constrained by the channel coherence time in Appendix B-A,
Appendix B-B, Appendix B-C. We treat this case in Ap-
pendix B-D.
A. Case 1: M  ?u (or M  ?p)
We consider different variation domains for paK and ?p in
order to study the optimization of the rate function Ra.
1) paK  ?p: In the expression Ra, SINRa can be
approximated as:
SINRa ?
M?p?
2
0
?2MKpa + ?
2
p2aK
2
(59)
provided that ?2M  ??0?p. Furthermore, if ?p?20 
?
2
paK, then SINRa  1.
The two conditions on ?0 are verified for Model 1 and
Model 3 (see Section II-B) provided ? is such that ?0 keeps
values of same order as ?2/? and ?. For Model 2, we assume
that the largest value of ?0, denoted as ?T , verifying the two
conditions is sufficiently large so that the expected value of the
log-term in (21) restricted to domain [0, ?T ] is approximately
equal to the expected value over the whole domain. This result
is used below where the expected value w.r.t. ?0 over the
restricted domain is approximated as ?. The same type of
conditions on ?0 are met in some of the derivations that will
follow, and can be treated in the same way so that we directly
consider the case of perfect power control to simplify.
13
Next, we proceed to Taylor series approximations in order
to find the optimal values of parameter paK first and then ?p.
We assume ?2M  ?2paK, equivalent to M  paK for the
models that we consider. A second order Taylor approximation
of the term in log gives:
Ra log(2) ?
?u ? ?p
?u
E?0
[
M?p?
2
0
?2M + ?
2
paK
? 1
2
(
?p?
2
0
?2
)2
1
Kpa
]
(60)
Taking the derivative w.r.t. the variable paK, we get:
?Ra
?paK
? 0? E?0
[
? M?p?
2
0?
2
[?2M + ?
2
paK]2
+
1
2
?2p?
4
0
?2
2
p2aK
2
]
? 0
(61)
We assume first ?2M  ?2paK. The other cases are treated
later. We obtain the expression of the optimal value of paK:
poaK =
?
1
2
?4
?
2
?2
?
M?p +O(?p). (62)
Next, keeping only the first order terms in ?p in (60), the
optimal value of ?p is the one maximizing (?u ? ?p)?p, i.e.,
?p =
?u
2
+O
(
?u
?
?u
M
)
. (63)
It can easily be verified that solutions poaK and ?
o
p are within
the definition intervals paK  ?p, ?2M  ?
2
paK for M 
?u. The maximum value of the sum rate is
Roa =
?u
4 log(2)
+O
(
?u
?
?u
M
)
. (64)
The last step is to verify that Ra does not get larger values
for the subcase where paK M or paK ?M . For paK 
M :
Ra ?
?u ? ?p
?u
paK log2
(
1 +
M?p
p2aK
2
)
. (65)
For a fixed ?p, Ra has its maximal value for poaK =?
M?p/
?
3s0, s0 ? 3.92 (see Section VI). As poaK  M ,
then paK > poaK and Ra decreases with paK and is maximal
when paK ? M , in which case Ra = ?u??p?u ?p/M . This
value is smaller than the maximal value found in the interval
paK M . For paK ?M , the value of the sum rate is also
smaller.
2) paK  ?p: The sum rate is approximated as
Ra ?
?u ? ?p
?u
paK log2
(
1 +
?p
Kpa
)
. (66)
For a fixed value of ?p, Ra increases with paK and takes its
maximal value when paK ? ?p, which case we consider next.
3) paK = ??p, ? = O(1):
Ra ?
?u ? ?p
?u
?p? log2(1 + 1/?). (67)
The maximal value is smaller than the one obtained in the
case paK  ?p.
B. Case 2: M  ?u
If M  ?p, then the results for Case 1 tells that the optimal
value is of the form (62) and (63). This solution can be
verified to give a smaller sum rate than the solution that is
given when M  ?p below. The case M ? ?p is treated in
Appendix B-C. We now assume M  ?p. Next we consider
different definition intervals for the parameters.
1) paK  ?p:
Ra ?
?u ? ?p
?u
paK log2
(
1 +
M?p
p2aK
2
)
. (68)
As already mentioned in Appendix B-A1, for a fixed ?p, Ra
has its maximal value for poaK =
?
M?p/
?
3s0, s0 ? 3.92.
As poaK  M , then paK < poaK and Ra increases with
paK and is maximal when paK ? ?p, in which case Ra =
?u??p
?u
M . This value is smaller than the maximal value found
in the interval paK  ?p.
2) paK  ?p: The SINR can be approximated as:
SINRa ?
M?p?
2
0
?
2
p2aK
2 + ?0??ppaK
. (69)
With the same steps as in Case 1, paK  ?p, we obtain
poaK =
?
1
2
?4
?
2
?2
?
M?p +O(M). (70)
For the optimization w.r.t. ?p, a first order Taylor approxi-
mation of Ra leads to
Ra log(2) ?
?u ? ?p
?u
(
M?p?
2
0
?
2
paK + ?0??p
)
(71)
? ?u ? ?p
?u
M E?0
(
?0
?
?
?
M
?
?p
)
(72)
? ?u ? ?p
?u
M
(
1?
?
M
?
?p
)
(73)
Taking the derivative, we find that the optimal point ?op is the
positive root of 3rd order polynomial equation:
?2x3/2 + ?
?
Mx+ ?u?
?
M = 0. (74)
Writing ?p as ?p = a?u, we get: ?2 ?uM a
3/2 + a+ 1 = 0.
Assuming a  1 and a  ?uM a
3/2, we obtain a =(
M
2?u
)2/3
. One can further prove that values of a that are
not close to 0 lead to invalid solutions. Finally, the solution
is:
?op =
(
M
2?u
)2/3
?u + o(?u). (75)
From (73), the sum rate can be written as:
Roa log(2) =M +O
(
M
[
M
?u
]2/3)
. (76)
14
3) paK = ??p, ? = O(1):
Ra ?
?u ? ?p
?u
??p log2
(
1 +
M?p
?2?2p + ??
2
p
)
(77)
? ?u ? ?p
?u
?
[
M
?+ 1
? 1
2
M2
(?+ 1)2?p
]
/ log(2). (78)
One can prove that the associated maximal value is smaller
than the one obtained in the case paK  ?p.
C. Case 3: M and ?u are of same order and M/?u = ?,
? = O(1).
We show that the solution is of the following form:
?op = a?u; p
o
aKa = b
?
M?u (79)
where a and b are scalars of order 1 and are solution of the
maximization of the function:
Ra=(1? a)bE?0
[
log2
(
1 +
a?20?
b?2?
?
? + b2?
2
? + ab??0
?
?
)]
. (80)
The expression (80) is obtained from the expression of Ra in
(21). One key point is that is only depends on M/?u = ?.
We show that a and b are of order 1 provided that ? is
of order 1 through numerical evaluations. In Figure 9, the
optimized values of a and b are shown as a function of ?. For
values of ? around 1, the values of a and b are indeed of order
1. When ? tends to ?, the value saturates to a = b = 1/2 as
predicted in Appendix B-A, while the values obtained when
? tends to 0 correspond to Appendix B-B2.
D. ?p constrained by the channel coherence time: ?p ? ?maxp .
For cases M  ?maxp and M  ?maxp , using equations (62)
and (70)
poaK =
?
1
2
?4
?
2
?2
?
M?maxp +O(M). (81)
For case M ? ?maxp , poaKa = b
?
M?maxp where b optimizes
Ra = b E?0
[
log2
(
1 +
?20?
?
b?2?
?
?? + b2?
2
?? + b??0
?
??
)]
. (82)
with ?? =M/?maxp .
REFERENCES
[1] T. L. Marzetta, “Noncooperative cellular wireless with unlimited
numbers of base station antennas,” IEEE Trans. Wireless Commun.,
vol. 9, no. 11, pp. 3590–3600, 2010.
[2] E. Bjo?rnson, E. G. Larsson, and T. L. Marzetta, “Massive MIMO: 10
myths and one critical question,” IEEE Commun. Mag., vol. 54, no. 2,
2016.
[3] A.O. Martinez, E. De Carvalho, and J. Nielsen, “Towards very large
aperture massive mimo: A measurement based study,” in 2014 IEEE
Globecom Workshops (GC Wkshps), Dec 2014, pp. 281–286.
[4] H. Q. Ngo, E. G. Larsson, and T. L. Marzetta, “Aspects of favorable
propagation in massive MIMO,” in Proc. IEEE EUSIPCO, 2014.
[5] E. Bjo?rnson, E. G. Larsson, and M. Debbah, “Massive MIMO for
maximal spectral efficiency: How many users and pilots should be
allocated?,” IEEE Trans. Wireless Commun., vol. 15, no. 2, pp. 1293–
1308, 2016.
[6] 5G Mobile and Wireless Communications Technology, Cambridge
University Press, 2016.
10-2 10-1 100 101 102 103
delta = M/?
u
0.1
0.2
0.3
0.4
0.5
0.6
0.7
0.8
0.9
?=0, ?=0.25
?=0
?=0.25
a
b
Fig. 9: Optimization of parameters a and b in Equation (82)
as a function of ?. Model 3 with ? = 0 and ? = 0.25.
[7] E. G. Larsson, F. Tufvesson, O. Edfors, and T. L. Marzetta, “Massive
MIMO for next generation wireless systems,” IEEE Commun. Mag.,
vol. 52, no. 2, pp. 186–195, 2014.
[8] H. Huh, G. Caire, H.C. Papadopoulos, and S.A. Ramprashad, “Achieving
“massive MIMO” spectral efficiency with a not-so-large number of
antennas,” IEEE Trans. Wireless Commun., vol. 11, no. 9, pp. 3226–
3239, 2012.
[9] H. Ngo, E. Larsson, and T. Marzetta, “Energy and spectral efficiency of
very large multiuser MIMO systems,” IEEE Trans. Commun., vol. 61,
no. 4, pp. 1436–1449, 2013.
[10] J. Hoydis, S. ten Brink, and M. Debbah, “Massive MIMO in the UL/DL
of cellular networks: How many antennas do we need?,” IEEE J. Sel.
Areas Commun., vol. 31, no. 2, pp. 160–171, 2013.
[11] J.H. Sørensen, E. de Carvalho, and P. Popovski, “Massive MIMO for
crowd scenarios: A solution based on random access,” in Globecom
Workshops (GC Wkshps), Dec 2014, pp. 352–357.
[12] J. H. Sørensen, E. de Carvalho, C. Stefanovic?, and P. Popovski,
“Coded pilot access: A random access solution for massive MIMO
systems,” IEEE Trans. Wireless Commun., 2016, Submitted, Available:
http://arxiv.org/pdf/1605.05862.
[13] E. Bjo?rnson, E. de Carvalho, E. G. Larsson, and P. Popovski, “Random
access protocol for massive MIMO: Strongest-user collision resolution
(SUCR),” in Proc. IEEE ICC, 2016.
[14] E. Bjo?rnson, E. de Carvalho, J. H. Sørensen, E. G. Larsson, and
P. Popovski, “A random access protocol for pilot allocation in crowded
massive mimo systems,” IEEE Transactions on Wireless Communica-
tions, vol. 16, no. 4, pp. 2220–2234, April 2017.
[15] L. Sanguinetti, A. A. D’Amico, M. Morelli, and M. Debbah, “Random
access in uplink massive MIMO systems: How to exploit asynchronicity
and excess antennas,” in IEEE Globecom, 2016.
[16] E. Bjo?rnson and E. G. Larsson, “Three practical aspects of massive
MIMO: Intermittent user activity, pilot synchronism, and asymmetric
deployment,” in Globecom Workshops (GC Wkshps), 2015.
[17] E. de Carvalho, E. Bjo?rnson, E. G. Larsson, and P. Popovski, “Random
access for massive MIMO systems with intra-cell pilot contamination,”
in Proc. IEEE ICASSP, 2016.
[18] E. Dahlman, S. Parkvall, and J. Skold, 4G: LTE/LTE-Advanced for
Mobile Broadband, Academic Press, 1st edition, 2011.
[19] A. Adhikary, J. Nam, J. Y. Ahn, and G. Caire, “Joint spatial division
and multiplexing - the large-scale array regime,” IEEE Transactions on
Information Theory, vol. 59, no. 10, pp. 6441–6463, Oct 2013.
[20] S.M. Kay, Fundamentals of Statistical Signal Processing: Estimation
Theory, Prentice Hall, 1993.
